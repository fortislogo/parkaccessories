<?xml version="1.0" encoding="UTF-8" ?>
<modification>
	<id><![CDATA[Google Analytics Expert]]></id>
	<version><![CDATA[1.5.2 - 1.5.5x - beautyshop]]></version>
	<vqmver><![CDATA[5.1.0]]></vqmver>
	<author><![CDATA[spitos]]></author>

<!-- begin admin changes -->
	<file name="admin/controller/setting/store.php">
		<operation>
			<search position="before" index="1"><![CDATA[
			$this->data['button_save'] = $this->language->get('button_save');
			]]></search>
			<add><![CDATA[
			$this->load->language('setting/setting');
			$this->data['entry_ga_tracking_type'] = $this->language->get('entry_ga_tracking_type');
			$this->data['entry_ga_conversion_id'] = $this->language->get('entry_ga_conversion_id');
			$this->data['entry_ga_remarketing'] = $this->language->get('entry_ga_remarketing');
			$this->data['entry_ga_cookie'] = $this->language->get('entry_ga_cookie');
			$this->data['entry_ga_label'] = $this->language->get('entry_ga_label');
			$this->data['entry_ua_tracking'] = $this->language->get('entry_ua_tracking');
			$this->data['entry_google_analytics'] = $this->language->get('entry_google_analytics');
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
			$this->data['text_image_manager'] = $this->language->get('text_image_manager');	
			]]></search>
			<add><![CDATA[
			$this->load->language('setting/setting');
			$this->data['text_classic'] = $this->language->get('text_classic');
			$this->data['text_universal'] = $this->language->get('text_universal');
			]]></add>
		</operation>	
		<operation>
			<search position="before" index="1"><![CDATA[
			$this->template = 'setting/store_form.tpl';
			]]></search>
			<add><![CDATA[
			if (isset($this->request->post['config_ga_tracking_type'])) {
				$this->data['config_ga_tracking_type'] = $this->request->post['config_ga_tracking_type'];
			} elseif (isset($store_info['config_ga_tracking_type'])) {
				$this->data['config_ga_tracking_type'] = $store_info['config_ga_tracking_type'];
			} else {
				$this->data['config_ga_tracking_type'] = '';
			}
			
			if (isset($this->request->post['config_ga_conversion_id'])) {
				$this->data['config_ga_conversion_id'] = $this->request->post['config_ga_conversion_id'];
			} elseif (isset($store_info['config_ga_conversion_id'])) {
				$this->data['config_ga_conversion_id'] = $store_info['config_ga_conversion_id'];
			} else {
				$this->data['config_ga_conversion_id'] = '';
			}
			
			if (isset($this->request->post['config_ga_remarketing'])) {
				$this->data['config_ga_remarketing'] = $this->request->post['config_ga_remarketing'];
			} elseif (isset($store_info['config_ga_remarketing'])) {
				$this->data['config_ga_remarketing'] = $store_info['config_ga_remarketing'];
			} else {
				$this->data['config_ga_remarketing'] = '';
			}
			
			if (isset($this->request->post['config_ga_cookie'])) {
				$this->data['config_ga_cookie'] = $this->request->post['config_ga_cookie'];
			} elseif (isset($store_info['config_ga_cookie'])) {
				$this->data['config_ga_cookie'] = $store_info['config_ga_cookie'];
			} else {
				$this->data['config_ga_cookie'] = '';
			}
			
			if (isset($this->request->post['config_ga_label'])) {
				$this->data['config_ga_label'] = $this->request->post['config_ga_label'];
			} elseif (isset($store_info['config_ga_label'])) {
				$this->data['config_ga_label'] = $store_info['config_ga_label'];
			} else {
				$this->data['config_ga_label'] = '';
			}
			
			if (isset($this->request->post['config_ua_tracking'])) {
				$this->data['config_ua_tracking'] = $this->request->post['config_ua_tracking'];
			} elseif (isset($store_info['config_ua_tracking'])) {
				$this->data['config_ua_tracking'] = $store_info['config_ua_tracking'];
			} else {
				$this->data['config_ua_tracking'] = '';
			}

			if (isset($this->request->post['config_google_analytics'])) {
				$this->data['config_google_analytics'] = $this->request->post['config_google_analytics'];
			} elseif (isset($store_info['config_google_analytics'])) {
				$this->data['config_google_analytics'] = $store_info['config_google_analytics'];
			} else {
				$this->data['config_google_analytics'] = '';
			}
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
			$this->data['tab_server'] = $this->language->get('tab_server');
			]]></search>
			<add><![CDATA[
			$this->data['tab_analytics'] = $this->language->get('tab_analytics');
			]]></add>
		</operation>
	</file>
	<file name="admin/view/template/setting/store_form.tpl">
		<operation>
			<search position="replace"><![CDATA[
			<a href="#tab-server"><?php echo $tab_server; ?></a>
			]]></search>
			<add><![CDATA[
			<a href="#tab-server"><?php echo $tab_server; ?></a><a href="#tab-analytics"><?php echo $tab_analytics; ?></a>
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[
			</form>
			]]></search>
			<add><![CDATA[
			<div id="tab-analytics">
          	<table class="form">
            <tr>
              <td><?php echo $entry_ga_tracking_type; ?></td>
              <td><?php if ($config_ga_tracking_type) { ?>
                <input type="radio" name="config_ga_tracking_type" value="1" <?php if ($config_ga_tracking_type == 1) { echo ' checked="checked"'; } ?> />
                <?php echo $text_classic; ?>
                <input type="radio" name="config_ga_tracking_type" value="2" <?php if ($config_ga_tracking_type == 2) { echo ' checked="checked"'; } ?> />
                <?php echo $text_universal; ?>
                <?php } else { ?>
                <input type="radio" name="config_ga_tracking_type" value="1" />
                <?php echo $text_classic; ?>
                <input type="radio" name="config_ga_tracking_type" value="2" checked="checked" />
                <?php echo $text_universal; ?>
                <?php } ?></td>
            </tr>
            <tr>
              <td><?php echo $entry_ua_tracking; ?></td>
              <td><input type="text" name="config_ua_tracking" value="<?php echo $config_ua_tracking; ?>" /></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_remarketing; ?></td>
              <td><?php if ($config_ga_remarketing) { ?>
              	<input type="radio" name="config_ga_remarketing" value="2" <?php if ($config_ga_remarketing == 2) { echo ' checked="checked"'; } ?> />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_remarketing" value="1" <?php if ($config_ga_remarketing == 1) { echo ' checked="checked"'; } ?> />
                <?php echo $text_enabled . ' (Only available with Classic tracking)'; ?>
                <?php } else { ?>
                <input type="radio" name="config_ga_remarketing" value="2" checked="checked" />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_remarketing" value="1" />
                <?php echo $text_enabled . ' (Only available with Classic tracking)'; ?>
                <?php } ?></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_cookie; ?></td>
              <td><?php if ($config_ga_cookie) { ?>
              	<input type="radio" name="config_ga_cookie" value="2" <?php if ($config_ga_cookie == 2) { echo ' checked="checked"'; } ?> />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_cookie" value="1" <?php if ($config_ga_cookie == 1) { echo ' checked="checked"'; } ?> />
                <?php echo $text_enabled; ?>
                <?php } else { ?>
                <input type="radio" name="config_ga_cookie" value="2" checked="checked" />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_cookie" value="1" />
                <?php echo $text_enabled; ?>
                <?php } ?></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_conversion_id; ?></td>
              <td><input type="text" name="config_ga_conversion_id" value="<?php echo $config_ga_conversion_id; ?>" /></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_label; ?></td>
              <td><input type="text" name="config_ga_label" value="<?php echo $config_ga_label; ?>" /></td>
            </tr>
			 </table>
        	</div>
			]]></add>
		</operation>
	</file>
	<file name="admin/controller/setting/setting.php">
		<operation>
			<search position="after"><![CDATA[
			$this->data['entry_error_filename'] = $this->language->get('entry_error_filename');
			]]></search>
			<add><![CDATA[
			$this->data['entry_ga_tracking_type'] = $this->language->get('entry_ga_tracking_type');
			$this->data['entry_ga_conversion_id'] = $this->language->get('entry_ga_conversion_id');
			$this->data['entry_ga_remarketing'] = $this->language->get('entry_ga_remarketing');
			$this->data['entry_ga_cookie'] = $this->language->get('entry_ga_cookie');
			$this->data['entry_ga_label'] = $this->language->get('entry_ga_label');
			$this->data['entry_ua_tracking'] = $this->language->get('entry_ua_tracking');
			]]></add>
		</operation>	
		<operation>
			<search position="after"><![CDATA[
			$this->data['text_smtp'] = $this->language->get('text_smtp');	
			]]></search>
			<add><![CDATA[
			$this->data['text_classic'] = $this->language->get('text_classic');
			$this->data['text_universal'] = $this->language->get('text_universal');
			$this->data['text_enabled'] = $this->language->get('text_enabled');
			$this->data['text_disabled'] = $this->language->get('text_disabled');
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[
			if (isset($this->request->post['config_google_analytics'])) {
			]]></search>
			<add><![CDATA[
			if (isset($this->request->post['config_ga_tracking_type'])) {
				$this->data['config_ga_tracking_type'] = $this->request->post['config_ga_tracking_type']; 
			} else {
				$this->data['config_ga_tracking_type'] = $this->config->get('config_ga_tracking_type');
			}
			
			if (isset($this->request->post['config_ga_conversion_id'])) {
				$this->data['config_ga_conversion_id'] = $this->request->post['config_ga_conversion_id']; 
			} else {
				$this->data['config_ga_conversion_id'] = $this->config->get('config_ga_conversion_id');
			}
			
			if (isset($this->request->post['config_ga_remarketing'])) {
				$this->data['config_ga_remarketing'] = $this->request->post['config_ga_remarketing']; 
			} else {
				$this->data['config_ga_remarketing'] = $this->config->get('config_ga_remarketing');
			}
			
			if (isset($this->request->post['config_ga_cookie'])) {
				$this->data['config_ga_cookie'] = $this->request->post['config_ga_cookie']; 
			} else {
				$this->data['config_ga_cookie'] = $this->config->get('config_ga_cookie');
			}
			
			if (isset($this->request->post['config_ga_label'])) {
				$this->data['config_ga_label'] = $this->request->post['config_ga_label']; 
			} else {
				$this->data['config_ga_label'] = $this->config->get('config_ga_label');
			}
			
			if (isset($this->request->post['config_ua_tracking'])) {
				$this->data['config_ua_tracking'] = $this->request->post['config_ua_tracking']; 
			} else {
				$this->data['config_ua_tracking'] = $this->config->get('config_ua_tracking');
			}
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
			$this->data['tab_server'] = $this->language->get('tab_server');
			]]></search>
			<add><![CDATA[
			$this->data['tab_analytics'] = $this->language->get('tab_analytics');
			]]></add>
		</operation>
	</file>
	<file name="admin/language/*/setting/setting.php">
		<operation>
			<search position="before"><![CDATA[
			// Heading
			]]></search>
			<add><![CDATA[
			//Tabs
			$_['tab_analytics']                  = 'Google Analytics Expert';
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[
			$_['entry_google_analytics']
			]]></search>
			<add><![CDATA[
			$_['entry_ga_tracking_type']    = 'Google Analytics Tracking Type:<br /><span style="font-size:11px;color:#666666;">Check out this blog as a quick reference for the differences in tracking types: <a href="http://cutroni.com/blog/2013/03/21/migrating-to-universal-analytics/" target="_blank">Migrating to Universal Analytics</a></span>';
			$_['entry_ga_conversion_id']    = 'Google AdWords Conversion ID:<br /><span style="font-size:11px;color:#666666;">If using AdWords, you can get this from the conversion you have set up</span>';
			$_['entry_ga_remarketing']      = 'Google Remarketing:<br /><span style="font-size:11px;color:#666666;">Set to Enabled if you have Remarketing campaigns enabled in a Google AdWords account that is linked to your Google Analytics account that you wish to track. This is currently only available with the Classic tracking code</span>';
			$_['entry_ga_cookie']      		= 'EU Cookie Consent Popup:<br /><span style="font-size:11px;color:#666666;">Set to Enabled if you are in the EU and wish to meet the requirements of the EU Cookie Law, which was enforced on 26th May 2012.</span>';
			$_['entry_ga_label']      		= 'Google AdWords Conversion Label:<br /><span style="font-size:11px;color:#666666;">If using AdWords, you can get this from the conversion you have set up</span>';
			$_['entry_ua_tracking']      	= 'Google Analytics Property ID:<br /><span style="font-size:11px;color:#666666;">Example: UA-12345678-1</span>';
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
			// Text
			]]></search>
			<add><![CDATA[
			$_['text_classic']    		= 'Classic';
			$_['text_universal']    	= 'Universal (New)';
			$_['text_enabled']    		= 'Enabled';
			$_['text_disabled']    		= 'Disabled';
			]]></add>
		</operation>
	</file>
	<file name="admin/view/template/setting/setting.tpl">
		<operation>
			<search position="replace" offset="1"><![CDATA[
			<td><?php echo $entry_google_analytics; ?></td>
			]]></search>
			<add><![CDATA[]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
			<a href="#tab-server"><?php echo $tab_server; ?></a>
			]]></search>
			<add><![CDATA[
			<a href="#tab-server"><?php echo $tab_server; ?></a><a href="#tab-analytics"><?php echo $tab_analytics; ?></a>
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[
			</form>
			]]></search>
			<add><![CDATA[
			<div id="tab-analytics">
          	<table class="form">
            <tr>
              <td><?php echo $entry_ga_tracking_type; ?></td>
              <td><?php if ($config_ga_tracking_type) { ?>
                <input type="radio" name="config_ga_tracking_type" value="1" <?php if ($config_ga_tracking_type == 1) { echo ' checked="checked"'; } ?> />
                <?php echo $text_classic; ?>
                <input type="radio" name="config_ga_tracking_type" value="2" <?php if ($config_ga_tracking_type == 2) { echo ' checked="checked"'; } ?> />
                <?php echo $text_universal; ?>
                <?php } else { ?>
                <input type="radio" name="config_ga_tracking_type" value="1" />
                <?php echo $text_classic; ?>
                <input type="radio" name="config_ga_tracking_type" value="2" checked="checked" />
                <?php echo $text_universal; ?>
                <?php } ?></td>
            </tr>
            <tr>
              <td><?php echo $entry_ua_tracking; ?></td>
              <td><input type="text" name="config_ua_tracking" value="<?php echo $config_ua_tracking; ?>" /></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_remarketing; ?></td>
              <td><?php if ($config_ga_remarketing) { ?>
              	<input type="radio" name="config_ga_remarketing" value="2" <?php if ($config_ga_remarketing == 2) { echo ' checked="checked"'; } ?> />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_remarketing" value="1" <?php if ($config_ga_remarketing == 1) { echo ' checked="checked"'; } ?> />
                <?php echo $text_enabled . ' (Only available with Classic tracking)'; ?>
                <?php } else { ?>
                <input type="radio" name="config_ga_remarketing" value="2" checked="checked" />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_remarketing" value="1" />
                <?php echo $text_enabled . ' (Only available with Classic tracking)'; ?>
                <?php } ?></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_cookie; ?></td>
              <td><?php if ($config_ga_cookie) { ?>
              	<input type="radio" name="config_ga_cookie" value="2" <?php if ($config_ga_cookie == 2) { echo ' checked="checked"'; } ?> />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_cookie" value="1" <?php if ($config_ga_cookie == 1) { echo ' checked="checked"'; } ?> />
                <?php echo $text_enabled; ?>
                <?php } else { ?>
                <input type="radio" name="config_ga_cookie" value="2" checked="checked" />
                <?php echo $text_disabled; ?>
                <input type="radio" name="config_ga_cookie" value="1" />
                <?php echo $text_enabled; ?>
                <?php } ?></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_conversion_id; ?></td>
              <td><input type="text" name="config_ga_conversion_id" value="<?php echo $config_ga_conversion_id; ?>" /></td>
            </tr>
            <tr>
              <td><?php echo $entry_ga_label; ?></td>
              <td><input type="text" name="config_ga_label" value="<?php echo $config_ga_label; ?>" /></td>
            </tr>
			 </table>
        	</div>
			]]></add>
		</operation>
	</file>
<!-- end admin changes -->

<!-- begin catalog changes -->
	<file name="catalog/controller/common/header.php">
		<operation>
            <search position="after"><![CDATA[
            $this->data['google_analytics'] = html_entity_decode($this->config->get('config_google_analytics'), ENT_QUOTES, 'UTF-8');
            ]]></search>
            <add><![CDATA[
            	$domainurl = new getDomain();
            	$this->data['domainurl'] = $domainurl->domain(HTTP_SERVER);
            ]]></add>
        </operation>
		<operation>
            <search position="before"><![CDATA[
            ?>
            ]]></search>
            <add><![CDATA[
		class getDomain {
            public function domain($url)
            {
                global $subtlds;
                $slds = "";
                $url = strtolower(preg_replace("(https?://)", "", $url));

               $host = parse_url('http://'.$url,PHP_URL_HOST);

                preg_match("/[^\.\/]+\.[^\.\/]+$/", $host, $matches);
                foreach($subtlds as $sub){
                    if (preg_match('/\.'.preg_quote($sub).'$/', $host, $xyz)){
                        preg_match("/[^\.\/]+\.[^\.\/]+\.[^\.\/]+$/", $host, $matches);
                    }
                }

                return @$matches[0];
            }

            public function get_tlds(){
            	global $subtlds;
                $address = 'http://mxr.mozilla.org/mozilla-central/source/netwerk/dns/effective_tld_names.dat?raw=1';
                $content = file($address);
                foreach($content as $num => $line){
                        $line = trim($line);
                        if($line == '') continue;
                        if(@substr($line[0], 0, 2) == '/') continue;
                        $line = @preg_replace("/[^a-zA-Z0-9\.]/", '', $line);
                        if($line == '') continue;  //$line = '.'.$line;
                        if(@$line[0] == '.') $line = substr($line, 1);
                        if(!strstr($line, '.')) continue;
                        $subtlds[] = $line;
                        //echo "{$num}: '{$line}'"; echo "<br>";
                }

                $subtlds = array_merge(array(
                        'co.uk', 'me.uk', 'net.uk', 'org.uk', 'sch.uk', 'ac.uk', 
                        'gov.uk', 'nhs.uk', 'police.uk', 'mod.uk', 'asn.au', 'com.au',
                        'net.au', 'id.au', 'org.au', 'edu.au', 'gov.au', 'csiro.au'
                        ),$subtlds);

                $subtlds = array_unique($subtlds);
            
                return $subtlds;    
            }
		} 
            
            $subtlds = new getDomain();
            $subtlds->get_tlds();
            ]]></add>
        </operation>
    </file>
	<file name="catalog/view/theme/*/template/common/header.tpl">
        <operation>
            <search position="replace"><![CDATA[<?php echo $google_analytics; ?>]]></search>
            <add><![CDATA[<?php if ($this->config->get('config_ga_tracking_type') == 1)  { ?>
<?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics">';} else{echo '<script type="text/javascript">'; } ?>

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '<?php echo $this->config->get("config_ua_tracking"); ?>']);
  _gaq.push(['_setDomainName', '<?php echo $domainurl; ?>']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
              
  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  <?php if ($this->config->get('config_ga_remarketing') == 1) { echo "ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';"; } else { echo "ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';"; } ?> 
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><?php } else if ($this->config->get('config_ga_tracking_type') == 2)  { ?>
<?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics">';} else{echo '<script>'; } ?>

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '<?php echo $this->config->get("config_ua_tracking"); ?>', '<?php echo $domainurl; ?>');
  ga('send', 'pageview');
</script><?php } ?>
<?php if ($this->config->get('config_ga_cookie') == 1)  { ?>

<script type="text/javascript">
	cc.initialise({
		cookies: {
			analytics: {}
		},
		settings: {}
	});
</script>
<?php } ?>]]></add>
        </operation>
		<!--<operation>
			<search position="after"><![CDATA[<script type="text/javascript" src="catalog/view/javascript/common.js"></script>]]></search>
			<add><![CDATA[<?php if ($this->config->get('config_ga_cookie') == 1)  { ?>
<link rel="stylesheet" type="text/css" href="catalog/view/theme/<?php echo $this->config->get('config_template'); ?>/stylesheet/cookie_consent.css" />
<script type="text/javascript" src="catalog/view/javascript/cookie_consent.js"></script>
<?php } ?>]]></add>
		</operation> -->
		<operation error="skip">
			<search position="after"><![CDATA[<link rel="stylesheet" type="text/css" href="catalog/view/theme/<?php echo $this->config->get('config_template'); ?>/stylesheet/ie7.css" />]]></search>
			<add><![CDATA[<style type="text/css">li#change-settings{position:relative;top:-26px}</style>]]></add>
		</operation>
	</file>
<!-- begin e-commerce -->
	<file name="catalog/controller/checkout/success.php">
        <operation>
            <search position="before"><![CDATA[
            $this->cart->clear();
            ]]></search>
            <add><![CDATA[
            $this->load->model('checkout/order');
			$this->data['orderDetails'] = $this->model_checkout_order->getOrder($this->session->data['order_id']);
			$this->data['orderProduct'] = $this->model_checkout_order->getOrderProduct($this->session->data['order_id']);  
			$this->data['orderProductOptions'] = $this->model_checkout_order->getOrderProductOptions($this->session->data['order_id']); 
			$this->data['orderDetails']['shipping_total'] = (isset($this->session->data['shipping_method']['cost'])) ? $this->session->data['shipping_method']['cost'] : 0;
            ]]></add>
        </operation>
	</file>
	<file name="catalog/model/checkout/order.php">
        <operation>
            <search position="before"><![CDATA[
            public function addOrder($data) {
            ]]></search>
            <add><![CDATA[
            public function getOrderProduct($order_id) {
   				$query = $this->db->query("SELECT cd.name as category_name,op.* FROM " . DB_PREFIX . "category_description cd INNER JOIN " . DB_PREFIX . "product_to_category pc ON pc.category_id = cd.category_id INNER JOIN " . DB_PREFIX . "order_product op ON pc.product_id = op.product_id LEFT JOIN " . DB_PREFIX . "order_option oo ON (oo.order_product_id = op.order_product_id) WHERE op.order_id = '" . (int)$order_id . "' AND pc.product_id = op.product_id AND oo.order_id IS NULL GROUP BY op.order_product_id");

            	return $query->rows;
       		 }
               
            public function getOrderProductOptions($order_id) {
				$query = $this->db->query("SELECT cd.name as category_name,op.*,oo.name as option_name, oo.value,oo.order_product_id,GROUP_CONCAT(DISTINCT oo.name, ': ', oo.value SEPARATOR ' - ') as options_data FROM " . DB_PREFIX . "category_description cd INNER JOIN " . DB_PREFIX . "product_to_category pc ON pc.category_id = cd.category_id INNER JOIN " . DB_PREFIX . "order_product op ON pc.product_id = op.product_id INNER JOIN " . DB_PREFIX . "order_option oo ON op.order_product_id = oo.order_product_id WHERE op.order_id = '" . (int)$order_id . "' AND pc.product_id = op.product_id AND op.order_product_id = oo.order_product_id GROUP BY oo.order_product_id");

            	return $query->rows;
       		 } 
            ]]></add>
        </operation> 
        <operation>
            <search position="before"><![CDATA[
            $this->load->model('localisation/language');
            ]]></search>
            <add><![CDATA[
            $tax_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_total WHERE order_id = '" . (int)$order_query->row['order_id'] . "' AND code = 'tax'");
			
			if ($tax_query->num_rows) {
				$order_tax = $tax_query->row['value'];
			} else {
				$order_tax = '';
			}  
            ]]></add>
        </operation>    
        <operation>
            <search position="after"><![CDATA[
            'total'                   => $order_query->row['total'],
            ]]></search>
            <add><![CDATA[
            'order_tax'       		  => $order_tax,  
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/common/success.tpl">
        <operation>
            <search position="after"><![CDATA[
            <?php echo $header; ?>
            ]]></search>
            <add><![CDATA[
            <?php if(isset($orderDetails) && (isset($this->request->get['route']) && $this->request->get['route'] == 'checkout/success' || $this->request->get['route'] == 'quickcheckout/success')) { ?>     
           	<?php if ($this->config->get('config_ga_tracking_type') == 1)  { ?>
           	<?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics">';} else{echo '<script type="text/javascript">'; } ?>

              _gaq.push(['_addTrans',
                '<?php echo $orderDetails['order_id']; ?>',
                '<?php echo addslashes($orderDetails['store_name']); ?>',
                '<?php echo round($orderDetails['total'], 2); ?>',
                '<?php echo round($orderDetails['order_tax'], 2); ?>',
                '<?php echo $orderDetails['shipping_total']; ?>',
                '<?php echo $orderDetails['shipping_city']; ?>',
                '<?php echo $orderDetails['shipping_zone']; ?>',
                '<?php echo $orderDetails['shipping_country']; ?>',
              ]);

            <?php if(isset($orderProduct)) { ?>
            <?php foreach($orderProduct as $product) { ?>
                _gaq.push(['_addItem',
                "<?php echo $product['order_id']; ?>",
                <?php if(isset($product['sku'])) { ?><?php echo json_encode(html_entity_decode($product['sku'],ENT_QUOTES, 'UTF-8')); ?><?php } else { ?><?php echo json_encode(html_entity_decode($product['model'],ENT_QUOTES, 'UTF-8')); ?><?php } ?>,
                <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                "<?php echo round($product['price'], 2); ?>",
                "<?php echo $product['quantity']; ?>"
              ]);
			<?php } ?>
 			<?php } ?>

			<?php if(isset($orderProductOptions)) { ?>
			<?php foreach($orderProductOptions as $product) { ?>
                _gaq.push(['_addItem',
                "<?php echo $product['order_id']; ?>",
                "<?php if(isset($product['sku'])) { ?><?php echo addslashes($product['sku']); ?><?php } else { ?><?php echo addslashes($product['model']); ?><?php } ?> - <?php echo html_entity_decode(addslashes($product['options_data']),ENT_QUOTES, 'UTF-8'); ?>",
                <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                "<?php echo round($product['price'], 2); ?>",
                "<?php echo $product['quantity']; ?>"
              ]);
			<?php } ?>
			<?php } ?>
			
              _gaq.push(['_trackTrans']); //submits transaction to the Analytics servers
              
              (function() {
              var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
              ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
              })();
            </script>  
            <?php } else if ($this->config->get('config_ga_tracking_type') == 2)  { ?>
            <?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics">';} else{echo '<script>'; } ?>
            
              ga('require', 'ecommerce', 'ecommerce.js');

              ga('ecommerce:addTransaction', {
                'id': '<?php echo $orderDetails['order_id']; ?>',
                'affiliation': '<?php echo addslashes($orderDetails['store_name']); ?>',
                'revenue': '<?php echo round($orderDetails['total'], 2); ?>',
                'tax': '<?php echo round($orderDetails['order_tax'], 2); ?>',
                'shipping': '<?php echo round($orderDetails['shipping_total'], 2); ?>'
              });

            <?php if(isset($orderProduct)) { ?>
            <?php foreach($orderProduct as $product) { ?>
              ga('ecommerce:addItem', {
                'id': '<?php echo $product['order_id']; ?>',
                'sku': <?php if(isset($product['sku'])) { ?><?php echo json_encode(html_entity_decode($product['sku'],ENT_QUOTES, 'UTF-8')); ?><?php } else { ?><?php echo json_encode(html_entity_decode($product['model'],ENT_QUOTES, 'UTF-8')); ?><?php } ?>,
                'name': <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                'category': <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                'price': '<?php echo round($product['price'], 2); ?>',
                'quantity': '<?php echo $product['quantity']; ?>'
              });
			<?php } ?>
 			<?php } ?>

			<?php if(isset($orderProductOptions)) { ?>
			<?php foreach($orderProductOptions as $product) { ?>
              ga('ecommerce:addItem', {
                'id': '<?php echo $product['order_id']; ?>',
                'sku': '<?php if(isset($product['sku'])) { ?><?php echo addslashes($product['sku']); ?><?php } else { ?><?php echo addslashes($product['model']); ?><?php } ?> - <?php echo html_entity_decode(addslashes($product['options_data']),ENT_QUOTES, 'UTF-8'); ?>',
                'name': <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                'category': <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                'price': '<?php echo round($product['price'], 2); ?>',
                'quantity': '<?php echo $product['quantity']; ?>'
              });
			<?php } ?>
			<?php } ?>

              ga('ecommerce:send');

            </script>
            <?php } ?>
            
            <?php if (!empty($ga_conversion_id) && (!empty($ga_label))) { ?> 
            <!-- begin Google Code for Adwords Conversion Page -->
            <?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics">';} else{echo '<script type="text/javascript">'; } ?>
            
            var google_conversion_id = <?php echo $this->config->get('config_ga_conversion_id'); ?>;
            var google_conversion_language = "en";
            var google_conversion_format = "3";
            var google_conversion_color = "666666";
            var google_conversion_label = "<?php echo $this->config->get('config_ga_label'); ?>";
            var google_conversion_value = <?php echo round(($orderDetails['total'] - $orderDetails['order_tax']), 2); ?>;
            </script>
            <<?php if ($this->config->get('config_ga_cookie') == 1) { echo 'script type="text/plain" class="cc-onconsent-analytics"';} else{echo 'script type="text/javascript"'; } ?> src="//www.googleadservices.com/pagead/conversion.js">
            </script>
            <noscript>
            <div style="display:none;visibility:hidden">
            <img height="1" width="1" style="border-style:none;" alt="" src="//www.googleadservices.com/pagead/conversion/<?php echo $this->config->get('config_ga_conversion_id'); ?>/?<?php if(isset($orderDetails)) { echo "value=" . round(($orderDetails['total'] - $orderDetails['order_tax']), 2); } ?>&amp;label=<?php echo $this->config->get('config_ga_label'); ?>&amp;guid=ON&amp;script=0"/>
            </div>
            </noscript>
            <!-- end Google Code for Adwords Conversion Page -->
            <?php } ?>
            
            <?php } ?>  
            ]]></add>
        </operation>
	</file>
<!-- end e-commerce -->

<!-- begin onepage/one step checkout operations -->
	<file name="catalog/view/theme/*/template/onecheckout/checkout.tpl" error="skip">
		<operation error="skip">
			<search position="after"><![CDATA[
			<?php echo $header; ?>
			]]></search>
			<add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout');";} else{echo "_gaq.push(['_trackPageview','/checkout']);"; } ?>">
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/onecheckout/success.php" error="skip">
        <operation error="skip">
            <search position="before"><![CDATA[
            $this->cart->clear();
            ]]></search>
            <add><![CDATA[
            $this->load->model('checkout/order');
			$this->data['orderDetails'] = $this->model_checkout_order->getOrder($this->session->data['order_id']);
			$this->data['orderProduct'] = $this->model_checkout_order->getOrderProduct($this->session->data['order_id']);  
			$this->data['orderProductOptions'] = $this->model_checkout_order->getOrderProductOptions($this->session->data['order_id']); 
			$this->data['orderDetails']['shipping_total'] = (isset($this->session->data['shipping_method']['cost'])) ? $this->session->data['shipping_method']['cost'] : 0;
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/onecheckout/success.tpl" error="skip">
        <operation error="skip">
            <search position="after"><![CDATA[
            <?php echo $header; ?>
            ]]></search>
            <add><![CDATA[
            <?php if(isset($orderDetails) && (isset($this->request->get['route']) && $this->request->get['route'] == 'onecheckout/success')) { ?>
            <?php if ($this->config->get('config_ga_tracking_type') == 1)  { ?>
            <?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics">';} else{echo '<script type="text/javascript">'; } ?>

              _gaq.push(['_addTrans',
                '<?php echo $orderDetails['order_id']; ?>',
                '<?php echo addslashes($orderDetails['store_name']); ?>',
                '<?php echo round($orderDetails['total'], 2); ?>',
                '<?php echo round($orderDetails['order_tax'], 2); ?>',
                '<?php echo $orderDetails['shipping_total']; ?>',
                '<?php echo $orderDetails['shipping_city']; ?>',
                '<?php echo $orderDetails['shipping_zone']; ?>',
                '<?php echo $orderDetails['shipping_country']; ?>',
              ]);
              
            <?php if(isset($orderProduct)) { ?>
            <?php foreach($orderProduct as $product) { ?>
                _gaq.push(['_addItem',
                "<?php echo $product['order_id']; ?>",
                <?php if(isset($product['sku'])) { ?><?php echo json_encode(html_entity_decode($product['sku'],ENT_QUOTES, 'UTF-8')); ?><?php } else { ?><?php echo json_encode(html_entity_decode($product['model'],ENT_QUOTES, 'UTF-8')); ?><?php } ?>,
                <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                "<?php echo round($product['price'], 2); ?>",
                "<?php echo $product['quantity']; ?>"
              ]);
			<?php } ?>
 			<?php } ?>
			
			<?php if(isset($orderProductOptions)) { ?>
			<?php foreach($orderProductOptions as $product) { ?>
                _gaq.push(['_addItem',
                "<?php echo $product['order_id']; ?>",
                "<?php if(isset($product['sku'])) { ?><?php echo addslashes($product['sku']); ?><?php } else { ?><?php echo addslashes($product['model']); ?><?php } ?> - <?php echo html_entity_decode(addslashes($product['options_data']),ENT_QUOTES, 'UTF-8'); ?>",
                <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                "<?php echo round($product['price'], 2); ?>",
                "<?php echo $product['quantity']; ?>"
              ]);
			<?php } ?>
			<?php } ?>
			
              _gaq.push(['_trackTrans']); //submits transaction to the Analytics servers
              
              (function() {
              var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
              ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
              })();
            </script>  
            
            <?php } else if ($this->config->get('config_ga_tracking_type') == 2)  { ?>
            <?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics">';} else{echo '<script>'; } ?>

              ga('require', 'ecommerce', 'ecommerce.js');

              ga('ecommerce:addTransaction', {
                'id': '<?php echo $orderDetails['order_id']; ?>',
                'affiliation': '<?php echo addslashes($orderDetails['store_name']); ?>',
                'revenue': '<?php echo round($orderDetails['total'], 2); ?>',
                'tax': '<?php echo round($orderDetails['order_tax'], 2); ?>',
                'shipping': '<?php echo round($orderDetails['shipping_total'], 2); ?>'
              });

            <?php if(isset($orderProduct)) { ?>
            <?php foreach($orderProduct as $product) { ?>
              ga('ecommerce:addItem', {
                'id': '<?php echo $product['order_id']; ?>',
                'sku': <?php if(isset($product['sku'])) { ?><?php echo json_encode(html_entity_decode($product['sku'],ENT_QUOTES, 'UTF-8')); ?><?php } else { ?><?php echo json_encode(html_entity_decode($product['model'],ENT_QUOTES, 'UTF-8')); ?><?php } ?>,
                'name': <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                'category': <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                'price': '<?php echo round($product['price'], 2); ?>',
                'quantity': '<?php echo $product['quantity']; ?>'
              });
			<?php } ?>
 			<?php } ?>

			<?php if(isset($orderProductOptions)) { ?>
			<?php foreach($orderProductOptions as $product) { ?>
              ga('ecommerce:addItem', {
                'id': '<?php echo $product['order_id']; ?>',
                'sku': '<?php if(isset($product['sku'])) { ?><?php echo addslashes($product['sku']); ?><?php } else { ?><?php echo addslashes($product['model']); ?><?php } ?> - <?php echo html_entity_decode(addslashes($product['options_data']),ENT_QUOTES, 'UTF-8'); ?>',
                'name': <?php echo json_encode(html_entity_decode($product['name'], ENT_QUOTES, 'UTF-8')); ?>,
                'category': <?php echo json_encode(html_entity_decode($product['category_name'], ENT_QUOTES, 'UTF-8')); ?>,
                'price': '<?php echo round($product['price'], 2); ?>',
                'quantity': '<?php echo $product['quantity']; ?>'
              });
			<?php } ?>
			<?php } ?>

              ga('ecommerce:send');
              
            </script>
            <?php } ?>
            
            <?php if (!empty($ga_conversion_id) && (!empty($ga_label))) { ?> 
            <!-- begin Google Code for Adwords Conversion Page -->
            <?php if ($this->config->get('config_ga_cookie') == 1) { echo '<script type="text/plain" class="cc-onconsent-analytics"';} else{echo '<script type="text/javascript"'; } ?>

            var google_conversion_id = <?php echo $this->config->get('config_ga_conversion_id'); ?>;
            var google_conversion_language = "en";
            var google_conversion_format = "3";
            var google_conversion_color = "666666";
            var google_conversion_label = "<?php echo $this->config->get('config_ga_label'); ?>";
            var google_conversion_value = <?php echo round(($orderDetails['total'] - $orderDetails['order_tax']), 2); ?>;
            </script>
            <<?php if ($this->config->get('config_ga_cookie') == 1) { echo 'script type="text/plain" class="cc-onconsent-analytics"';} else{echo 'script type="text/javascript"'; } ?> src="//www.googleadservices.com/pagead/conversion.js">
            </script>
            <noscript>
            <div style="display:none;visibility:hidden">
            <img height="1" width="1" style="border-style:none;" alt="" src="//www.googleadservices.com/pagead/conversion/<?php echo $this->config->get('config_ga_conversion_id'); ?>/?<?php if(isset($orderDetails)) { echo "value=" . round(($orderDetails['total'] - $orderDetails['order_tax']), 2); } ?>&amp;label=<?php echo $this->config->get('config_ga_label'); ?>&amp;guid=ON&amp;script=0"/>
            </div>
            </noscript>
            <!-- end Google Code for Adwords Conversion Page -->
            <?php } ?>
            
            <?php } ?>  
            ]]></add>
        </operation>
	</file>
<!-- end onepage/one step checkout operations -->

<!-- begin uber checkout operations -->
	<file name="catalog/view/theme/*/template/checkout/checkout_one.tpl" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
			<div id="content">
			]]></search>
			<add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout-one');";} else{echo "_gaq.push(['_trackPageview','/checkout-one']);"; } ?>">
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/checkout_two.tpl" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
			<div id="content">
			]]></search>
			<add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout-two');";} else{echo "_gaq.push(['_trackPageview','/checkout-two']);"; } ?>">
			]]></add>
		</operation>
	</file>
<!-- end uber checkout operations -->

<!-- begin quick checkout operations -->
	<file name="catalog/view/theme/*/template/quickcheckout/checkout.tpl" error="skip">
		<operation error="skip">
			<search position="before"><![CDATA[
			<?php echo $content_top; ?>
			]]></search>
			<add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout');";} else{echo "_gaq.push(['_trackPageview','/checkout']);"; } ?>">
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/quickcheckout/success.php" error="skip">
        <operation error="skip">
            <search position="before"><![CDATA[
            $this->cart->clear();
            ]]></search>
            <add><![CDATA[
            $this->load->model('checkout/order');
			$this->data['orderDetails'] = $this->model_checkout_order->getOrder($this->session->data['order_id']);
			$this->data['orderProduct'] = $this->model_checkout_order->getOrderProduct($this->session->data['order_id']);  
			$this->data['orderProductOptions'] = $this->model_checkout_order->getOrderProductOptions($this->session->data['order_id']); 
			$this->data['orderDetails']['shipping_total'] = (isset($this->session->data['shipping_method']['cost'])) ? $this->session->data['shipping_method']['cost'] : 0;
            ]]></add>
        </operation>
	</file>
<!-- end quick checkout operations -->

<!-- begin goal funnel -->
	<file name="catalog/view/theme/*/template/checkout/login.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <div class="left">
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/login');";} else{echo "_gaq.push(['_trackPageview','/checkout/login']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/register.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <div class="left">
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/billingaddress');";} else{echo "_gaq.push(['_trackPageview','/checkout/billingaddress']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/payment_address.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <?php if ($addresses) { ?>
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/billingaddress');";} else{echo "_gaq.push(['_trackPageview','/checkout/billingaddress']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/shipping_address.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <?php if ($addresses) { ?>
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/shippingaddress');";} else{echo "_gaq.push(['_trackPageview','/checkout/shippingaddress']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/shipping_method.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <?php if ($error_warning) { ?>
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/shippingmethod');";} else{echo "_gaq.push(['_trackPageview','/checkout/shippingmethod']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/guest.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <div class="left">
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/billingaddress');";} else{echo "_gaq.push(['_trackPageview','/checkout/billingaddress']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/guest_shipping.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <table class="form">
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/shippingaddress');";} else{echo "_gaq.push(['_trackPageview','/checkout/shippingaddress']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/payment_method.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <?php if ($error_warning) { ?>
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/payment');";} else{echo "_gaq.push(['_trackPageview','/checkout/payment']);"; } ?>">
            ]]></add>
        </operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/confirm.tpl">
       	<operation>
            <search position="before" index="1"><![CDATA[
            <div class="checkout-product">
            ]]></search>
            <add><![CDATA[
			<img src="image/data/ga.png" onload="<?php if ($this->config->get('config_ga_tracking_type') == 2) { echo "ga('send', 'pageview', '/checkout/confirm');";} else{echo "_gaq.push(['_trackPageview','/checkout/confirm']);"; } ?>">
            ]]></add>
        </operation>
	</file>
<!-- end goal funnel -->

<!-- begin event tracking -->
	<file name="catalog/view/theme/*/template/module/featured.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Featured Product', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Featured Product', 'Add to Wishlist', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Featured Product', 'Compare', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/module/latest.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Latest', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Latest', 'Add to Wishlist', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Latest', 'Compare', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/module/special.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Specials', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Specials', 'Add to Wishlist', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Specials', 'Compare', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/module/bestseller.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Best Selller', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Best Selller', 'Add to Wishlist', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Best Selller', 'Compare', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>

	</file>
	<file name="catalog/view/theme/*/template/product/category.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Category Page', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Category Page', 'Add to Compare', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Category Page', 'Add to Wishlist', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/product/compare.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<input type="button" value="<?php echo $button_cart; ?>" onclick="addToCart('<?php echo $product['product_id']; ?>');" class="button" />
			]]></search>
			<add><![CDATA[
			<input type="button" value="<?php echo $button_cart; ?>" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Comparison Page', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);" class="button" />
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/product/product.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Related Product', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-cart" id="button-cart">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-cart" id="button-cart" onclick="_gaq.push(['_trackEvent', 'Product Page', 'Add to Cart', '<?php echo htmlspecialchars($heading_title,ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product_id; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product_id; ?>'); _gaq.push(['_trackEvent', 'Product Page', 'Add to Compare', '<?php echo htmlspecialchars($heading_title,ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product_id; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product_id; ?>'); _gaq.push(['_trackEvent', 'Product Page', 'Add to Wishlist', '<?php echo htmlspecialchars($heading_title,ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/product/search.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Search Page', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Search Page', 'Add to Compare', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Search Page', 'Add to Wishlist', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/product/special.tpl">
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-cart" onclick="addToCart('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Specials', 'Add to Cart', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-compare" onclick="addToCompare('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Specials', 'Add to Compare', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>');">
			]]></search>
			<add><![CDATA[
			<div class="pbuttons buttons-wish" onclick="addToWishList('<?php echo $product['product_id']; ?>'); _gaq.push(['_trackEvent', 'Specials', 'Add to Wishlist', '<?php echo htmlspecialchars($product['name'],ENT_QUOTES); ?>']);">
			]]></add>
		</operation>
	</file>
<!-- end event tracking -->
<!-- end catalog changes -->

</modification>